# January 2026 Status Update for Olivier Certner

## **Reporting Period:** 2026-01-14 - 2026-01-20

### Power / Hibernate (S4) \[Laptop Project\]
- More code analysis and design work
  - Quiescing the system
    - `stop_all_proc()`: To be launched from a kernel process.
    - `suspend_all_fs()`: Could be more strict with respect to errors.  Calls
      `vfs_write_suspend()` and thus `VFS_SYNC()`.  Looks like it should be enough
      (has been used for S4BIOS), but: What about the syncer?  Do we need to forcibly
      flush buffers in addition?
    - Using the `power_suspend_early` and `power_suspend` hooks is fine.
    - In order to avoid an inconsistent image with respect to devices (kernel
      threads, DMA, etc.), will need to suspend them before taking the snapshot.
  - Taking a snapshot
    - TODO: Discard cached vnodes.
    - TODO: Free all disk buffers.
    - TODO: Initiate the copy (analysis of `dumpsys()` to help with this).
  - Writing the image
    - Analyze of `doadump()`, `dumpsys()`, and the dump machinery (and setting
      GEOM devices as dump devices).
    - Reading spec of ELF format.
    - Just started: An alternative to `dumpsys()` that will emit an ELF image as
      described in the hibernate HackMD document.  Aim: Progress first to image
      production, even if inconsistent, so that `kib@` can test the resume path
      without having to wait for the final suspend path.
    - TODO: An alternative to `dumpsys()` that operates on an image rather than on
      the `dump_map[]`.
    - Identified a missing piece: Need to selectively wake-up the disk device to
      be able to actually write the image.
  - Shutting down the system
    - We absolutely cannot allow the system to write anything to disk after the
      image has been written.  Thus, we cannot use `shutdown_nice()` directly,
      because we cannot convey this constraint to `init(8)` (also, we do not
      want to run `rc.shutdown(8)`).  Looks like directly calling
      `kern_reboot()` like `RB_NOSYNC` should be enough.  To check: The shutdown
      hooks must not mess with filesystems on disk (but we still want to flush
      caches).
- BSDCan 2026: Submit a talk.

### Power / Suspend-to-idle (S0ix) \[Laptop Project\]
- Review [D54777](https://reviews.freebsd.org/D54777) ("acpi: Fix not calling
  AcpiLeaveSleepState() in S3 path"): Approve (we missed this problem in
  [D48734](https://reviews.freebsd.org/D48734)).
- New review for [D48387](https://reviews.freebsd.org/D48387) ("acpi_spmc: Add
  SPMC (system power management controller) driver").  Some changes still to be
  done.
- Review [D54407](https://reviews.freebsd.org/D54407) ("sched: Flag to force
  scheduler to always choose idle thread").  Suggest changes.  Globally on hold
  until we clarify what's going on in D54410.
- Review [D54410](https://reviews.freebsd.org/D54410) ("acpi: Implement s2idle
  loop"): Asking for more details about the why, in order to check if we are
  really going into the right direction and to fuel the reflection on which
  basic blocks are really needed.

### Laptop Project Admin
- Attend the Power weekly meeting.

### `mac_do(4)`/`mdo(1)`
- AsiaBSDCon 2026: Work on and send a camera-ready paper.

### MAC framework (mac(4))
- Review [D54737](https://reviews.freebsd.org/D54737) ("RELNOTES: document the
  MAC/jail integration"), suggest a change.
- Review [D54748](https://reviews.freebsd.org/D54748) ("mac(4): also list jails
  in the example enumeration of objects"): Prompted by my comment in
  [D54737](https://reviews.freebsd.org/D54737), approve.

### Scheduler
- Respond to Minsoo Choo's initial email about heterogeneous support ("HMP").
  Will review the `cpucap` framework.  State that I have been working on design
  and the scheduler side of things.
- Send a mail about ULE and other schedulers (CFS) to correct misconceptions and
  state my next plans for it, irrespective of heterogeneous support.
- Further discussion with several people happens, especially in reaction to my
  desire to deprecate 4BSD if possible.


## **Reporting Period:** 2026-01-07 - 2026-01-13

### Power / Hibernate (S4) \[Laptop Project\]
- Start modifying `sys/dev/acpica/acpi.c`, in particular
  `acpi_EnterSleepState()`, to support OS-initiated S4.  First step: Quiescing
  the system.  Read some more aspects of S4 sleep/wakeup in the ACPI spec.
- There's some technical debt though, so work on some small changes around
  that code.  Consequently, work on and create:
  - [D54624](https://reviews.freebsd.org/D54624) ("acpi: Use only
    AcpiGetSleepTypeData() to determine Sx support")
  - [D54625](https://reviews.freebsd.org/D54625) ("acpi: Use AcpiGbl_FACS even
    on ACPI_REDUCED_HARDWARE")
  - [D54626](https://reviews.freebsd.org/D54626) ("acpi: 'hw.acpi.s4bios'
    sysctl: Change type to bool, expand description")
  - [D54627](https://reviews.freebsd.org/D54627) ("acpi: New R/O
    'hw.acpi.s4bios_supported' sysctl, gate S4BIOS with it")

### Dynamic P-state support (CPPC) \[Laptop Project\]
- [D54505](https://reviews.freebsd.org/D54505) ("hwpstate_amd: Use ipi instead
  of sched_bind + thread_lock"): Review and approve the latest version.

### Power / Suspend-to-idle (S0ix) \[Laptop Project\]
- New review of [D48734](https://reviews.freebsd.org/D48734) ("acpi:
  Suspend-to-idle support (s2idle)"): Iterate with `obiwac@` to fix some
  problems, finally approve.
- New review of [D48387](https://reviews.freebsd.org/D48387) ("acpi_spmc: Add
  SPMC (system power management controller) driver"): Review latest changes by
  `obiwac@`, and some parts I didn't have time to last time, in particular
  treatment of Low Power S0 Idle device constraints and plumbing of `acpi_spmc`
  into the ACPI framework.  Request and suggest more changes.
- Start reviewing:
  - [D54407](https://reviews.freebsd.org/D54407) ("sched: Flag to force
    scheduler to always choose idle thread")
  - [D54409](https://reviews.freebsd.org/D54409) ("x86: New (un)idle IPIs for
    setting idle flag in scheduler")
  - [D54410](https://reviews.freebsd.org/D54410) ("acpi: Implement s2idle loop")

### Laptop Project Admin
- Attend the Power weekly meeting.
- Prepare a summary for the Laptop Project Iteration Planning meeting.

### MFC to `stable/14`
- [Commit 2c3fb4cd5096](https://cgit.freebsd.org/src/commit/?id=2c3fb4cd5096)
  ("racct: Improve handling of the pcpu resource"): MFC with removing the
  dubious reset we were doing on %CPU for processes that are swapped out.
- [D54284](https://reviews.freebsd.org/D54284) ("kern: racct: Remove code unused
  since %cpu resource computation revamp").

### Misc
- [Commit 730b3e20069b](https://cgit.freebsd.org/src/commit/?id=730b3e20069b)
  ("ps(1): Sort headers")
- [Commit fde9fe18219f](https://cgit.freebsd.org/src/commit/?id=fde9fe18219f)
  ("i386: Fix kernel compilation after introduction of ASMC\_DEBUG option"): To
  fix i386 compilation broken by [commit
  f224591746bd](https://cgit.freebsd.org/src/commit/?id=f224591746bd) ("Add
  ASMC_DEBUG make option")
- [Commit 8342d9f7b5f1](https://cgit.freebsd.org/src/commit/?id=8342d9f7b5f1)
  ("asmc(4): Stop building it on i386, as it supports only 64-bit chipsets"):
  Followup of [commit
  fde9fe18219f](https://cgit.freebsd.org/src/commit/?id=fde9fe18219f) after
  a remark by `ngie@`.
- [Commit 67599eef01f5](https://cgit.freebsd.org/src/commit/?id=67599eef01f5)
  ("sys/x86/NOTES: Add vt_efifb")
- [Commit 9c25620e57f0](https://cgit.freebsd.org/src/commit/?id=9c25620e57f0)
  ("sys: vt_efifb: EFI not supported on i386; move it back to amd64/NOTES"):
  Followup of [commit
  67599eef01f5](https://cgit.freebsd.org/src/commit/?id=67599eef01f5) after
  a remark by `jhb@`.

### `srcmgr@` Lurker
- Update [D52885](https://reviews.freebsd.org/D52885) ("style.9: Encourage style
  changes when doing significant modifications").
- Attend bi-weekly meeting.  Talk about i386 compilation.

### Review of Others' Work
- VFS
  - [D54376](https://reviews.freebsd.org/D54376) ("cache: avoid hardcoded zone
    alignment"): Approve with suggestions.
  - [D54553](https://reviews.freebsd.org/D54553) ("cache: avoid hardcoded cache
    padding"): Approve with suggestions.
  - [D54554](https://reviews.freebsd.org/D54554) ("cache: avoid hardcoded
    CACHE_PATH_CUTOFF"): Suggestions.


## **Reporting Period:** 2026-01-05 - 2026-01-06

### Dynamic P-state support (CPPC) \[Laptop Project\]
- [D49587](https://reviews.freebsd.org/D49587) ("hwpstate: add CPPC support for
  pstate driver on AMD"): Comment on `markj@`'s comment on the
  `machdep.hwpstate_pkg_ctrl` sysctl knob warning, with some future plans.
- [D54528](https://reviews.freebsd.org/D54528) ("hwpstate: Use dynamic sysctl
  initialization"): Review, advise to preferably avoid converting unique knobs.
- [D54505](https://reviews.freebsd.org/D54505) ("hwpstate_amd: Use ipi instead
  of sched_bind + thread_lock"): Spot a small bug following changes requested by
  `markj@`, and another bug in a new version (return code of
  `amdhwp_dump_sysctl_handler()`; changes requested).

### `mac_do(4)`/`mdo(1)`
- AsiaBSDCon 2026 submission accepted!

### MFC to `stable/15`
MFC all my backlog, including:

- [D49318](https://reviews.freebsd.org/D49318) ("libsa: smbios: Detect
  less-than-64-bit platforms via __SIZEOF_SIZE_T__").
- [D52441](https://reviews.freebsd.org/D52441) ("uma_core: Rely on domainset
  iterator to wait on M_WAITOK").
- [D53636](https://reviews.freebsd.org/D53636) ("proc_set_cred(): Allow
  'newcred' to have multiple references").
- [D53563](https://reviews.freebsd.org/D53563) ("kern: RACCT: Keep process
  credentials alive via references").
- [D52441](https://reviews.freebsd.org/D52441) ("uma_core: Rely on domainset
  iterator to wait on M_WAITOK").
- [D53771](https://reviews.freebsd.org/D53771) ("mdo(1): Avoid calling
  getgroups() in some unnecessary cases").
- [D53772](https://reviews.freebsd.org/D53772) ("setcred(): Remove an
  optimization for when cr_groups[0] was the egid").  As dependencies, also
  MFCed these commits:
  - [D53755](https://reviews.freebsd.org/D53755) ("MAC: Use the current thread's
    user ABI to determine the layout of struct mac").
  - [D53756](https://reviews.freebsd.org/D53756) ("setcred: Move initial copyin
    of struct setcred out to per-ABI syscall").
  Also MFCed the following fix:
  - [Commit 000d5b52c19f](https://cgit.freebsd.org/src/commit/?id=000d5b52c19f)
    ("setcred(2): Fix a panic on too many groups from latest commit").
- [D54271](https://reviews.freebsd.org/D54271) ("jail: Don't define malloc type
  M_PRISON_RACCT on !RACCT").
- [D54284](https://reviews.freebsd.org/D54284) ("kern: racct: Remove code unused
  since %cpu resource computation revamp").

### MFC to `stable/14`
- [D54271](https://reviews.freebsd.org/D54271) ("jail: Don't define malloc type
  M_PRISON_RACCT on !RACCT").
- Discuss with `markj@` about tentatively MFCing [commit
  c72188d85a79](https://cgit.freebsd.org/src/commit/?id=c72188d85a79) ("racct:
  Improve handling of the pcpu resource").


## **Reporting Period:** 2026-01-01 - 2026-01-04

Off.
