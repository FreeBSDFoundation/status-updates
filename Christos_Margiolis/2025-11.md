# November 2025 Status Update for Christos Margiolis

## **Reporting Period:** 2025-11-11 - 2025-11-17

### Project: Audio Stack Improvements

**Overall Status:** On Track

#### Completed Tasks

- sound examples: Extend and clean up: https://cgit.freebsd.org/src/commit/?id=6a569666868b36f5f436eea9d66789b6df191b8a
- cuse: Fix cdevpriv bugs in cuse_client_open(): https://cgit.freebsd.org/src/commit/?id=634e578ac7b0a03ae25427c723c0da27e894a340
- sound: Remove KOBJMETHOD_END re-definitions: https://cgit.freebsd.org/src/commit/?id=4c05ff1d5ad206d6074151f747a1dd272487555c
- sound: Remove dead midi code: https://cgit.freebsd.org/src/commit/?id=e4b31985b54b626b2bbf486a82dd789f3dd381db
- sound: Retire unused mixer functions: https://cgit.freebsd.org/src/commit/?id=b55adf9b261b91ddd3c7293720bbbbfb4ffe7066
- sound: Move mixer->modify_counter to more appropriate place: https://cgit.freebsd.org/src/commit/?id=15d77c1fdcb1c7f022a21892dcb78990986f1a3c
- sound: Retire OLDPCM_IOCTL: https://cgit.freebsd.org/src/commit/?id=1fe7bfd6c70160c064237eac104e7d9c71390c4f
- sound: Remove unnecessary uio checks in dsp_io_ops(): https://cgit.freebsd.org/src/commit/?id=6b5431941c10b6fdf164ad9d3dfa4b4f1b2edc22
- sound: Do not use double pointer in dsp_io_ops(): https://cgit.freebsd.org/src/commit/?id=fa7bc983076661e85107970e39de66a1e54d87d1
- sound: Retire SND_DIAGNOSTIC PCM locking macros: https://cgit.freebsd.org/src/commit/?id=b19e61f223a1982cce103b9716568391a071892a
- snd_hda: Patch Lenovo V15: https://cgit.freebsd.org/src/commit/?id=5f624d923db0f2fb33990948cffdc24da44deaa8
	- Fixes [PR 290496](https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=290496)

#### Ongoing Tasks

- sound: Fix KASSERT panics in chn_read() and chn_write(): https://reviews.freebsd.org/D53666
- sound: Simplify logic in dsp_io_ops(): https://reviews.freebsd.org/D53736
- [PR 290965](https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=290965)
- Investigating some locking bugs in sound(4).
- MIDI work.

#### Code Reviews

- sound examples: Add mmap example: https://reviews.freebsd.org/D53749
- sound/midi: midi_poll is always failing: https://github.com/freebsd/freebsd-src/pull/1887
- sound/mpu: clarify MPU-401 init: https://github.com/freebsd/freebsd-src/pull/1888

## **Reporting Period:** 2025-11-04 - 2025-11-10

### Project: Audio Stack Improvements

**Overall Status:** On Track

#### Completed Tasks

- sound: Add kqueue support: https://cgit.freebsd.org/src/commit/?id=4181bf9d18166c4061bfa137b8a46972a5a55f67
- sound tests: Fix select(2) arguments: https://cgit.freebsd.org/src/commit/?id=41f2ec3be93a2981e5afcc2569e6abcc64414437
- rc: virtual_oss: Use required_modules instead of load_kld: https://cgit.freebsd.org/src/commit/?id=ac2aa9e869a16b28095364b2e14683df9885ac34
- virtual_oss(8): Use kldload(2) instead of system(3): https://cgit.freebsd.org/src/commit/?id=7bedc4634d893174b9cef06c7c13e5f1cb24808b
- virtual_oss(8): Improve hw.snd.basename_clone handling: https://cgit.freebsd.org/src/commit/?id=e5c0d7020f3d040b28dc7ca0cda9926e07e5aaf4

#### Ongoing Tasks

- sound: Fix KASSERT panics in chn_read() and chn_write(): https://reviews.freebsd.org/D53666
	- It does not fully fix the panics, so the digging continues...
- sound tests: Test hot-unload: https://reviews.freebsd.org/D53614
- Implementing kqueue(2) support for virtual_oss(8). Unfortunately it requires
  patches to cuse(3) and cuse(4) as well.

#### Code Reviews

- sound examples: Extend and clean up: https://reviews.freebsd.org/D53353

## **Reporting Period:** 2025-10-28 - 2025-11-03

### Project: Audio Stack Improvements

**Overall Status:** On Track

#### Completed Tasks

- sound tests: Test polling: https://cgit.freebsd.org/src/commit/?id=dd81b19ef23622d03d7c75935e11c2b2af3f4cb8
- sound: Clarify userland/vchan relationship in sndstat feeder chain: https://cgit.freebsd.org/src/commit/?id=59d7865d3c20e86b3c42096f4a8c06a5e2eebd29
- sound: Retire unused snd_dbuf->dir: https://cgit.freebsd.org/src/commit/?id=3ba4e3d352e5fbc550645a76064ca16460616d86
- sound: Retire snd_dbuf->dev: https://cgit.freebsd.org/src/commit/?id=55540ebc33ad9a52bc4de121cb598243153981a8
- sound: Re-arrange sndbuf_create() arguments: https://cgit.freebsd.org/src/commit/?id=482d0d97885506a5eb2b1f2501f65e7e4fca6fdc
- sound: Define SNDBUF_F_MANAGED as 0x00000001: https://cgit.freebsd.org/src/commit/?id=d159b023de52570800d5a5292318de4bce3c9978
- sound: Retire unused sndbuf_dump(): https://cgit.freebsd.org/src/commit/?id=6d6eb25d0b19443089749e288f091bf26fc58f70
- sound: Retire unused sndbuf_getflags() and sndbuf_setflags(): https://cgit.freebsd.org/src/commit/?id=06eb65e11d7a66caec358966dcf892c9f4c2e411
- sound: Simplify sndbuf_clear() loop: https://cgit.freebsd.org/src/commit/?id=c0e96595a4da90d890be88881a5dc3381da59dd7
- sound: Remove redundant sndbuf_free() in chn_kill(): https://cgit.freebsd.org/src/commit/?id=ad28c6a13a45746f32cbc832b3fe58748fae0d19
- sound: Get rid of useless sndbuf getters and setters: https://cgit.freebsd.org/src/commit/?id=78c5026ae13b2d30b479f9bc892ecdb6f5a5bc0b
- sound: Add to pcm/buffer.* copyright: https://cgit.freebsd.org/src/commit/?id=4e2bf54d9f2e9a2a51dbdcebf079089615102f1c
- sound: Retire unused {pcm_feederdesc,feedertab_entry}->idx: https://cgit.freebsd.org/src/commit/?id=f1157508b37d66c0e038b2a3346858999bcd5984
- sound: Retire MAXFEEDERS and feedercnt: https://cgit.freebsd.org/src/commit/?id=84282785cc497c3fb798502899f880e15d063233
- sound: Remove unnecessary pcm/vchan.h include from pcm/feeder.c: https://cgit.freebsd.org/src/commit/?id=6049209f35c39823f6f9a756953b361d52658812
- sound: Simplify pcm_feederdesc initialization: https://cgit.freebsd.org/src/commit/?id=7d33c3d651901c97a683689916c810cf4e26a057
- sound: Retire unused pcm_feederdesc->flags: https://cgit.freebsd.org/src/commit/?id=0e9e222518dc543e34f891c00d2a6a1dd93c3fc2
- sound: Simplify feeder_getclass(): https://cgit.freebsd.org/src/commit/?id=441a411853e48719d4aa6a36bba0a4c4cbca3a4f
- sound: Retire feedertab_entry: https://cgit.freebsd.org/src/commit/?id=c24ca02c4c85d0b691a6100fd3006b1f23061858
- sound: Retire feeder_class->data: https://cgit.freebsd.org/src/commit/?id=762f8e6f515a33274503872cf597e0895ff706bc
- sound: Retire feeder_class->desc: https://cgit.freebsd.org/src/commit/?id=91fcc0132d0b192f07f9b67626c9af2ad8759857
- sound: Retire pcm_feederdesc->type: https://cgit.freebsd.org/src/commit/?id=92dcd20222a2674ba31ae09865da19d948992994
- sound: Remove unnecessary initializations in feeder_create(): https://cgit.freebsd.org/src/commit/?id=699fd108c50ccbd576476a2c95fa03e16492f2f9
- sound: Retire unused feeder_printchain(): https://cgit.freebsd.org/src/commit/?id=f4819a1b6c441f804d66d710678bf5558ee29eee
- sound: Retire feeder_register_root(): https://cgit.freebsd.org/src/commit/?id=2ba68208390a2c091039eb6731cdc2ebe280f89a
- sound: Retire DSP_DEFAULT_SPEED: https://cgit.freebsd.org/src/commit/?id=16ae4c2398c89dcc5c03f1aac72a2fce2a60e724
- sound: Retire unused SCF_SYNTH: https://cgit.freebsd.org/src/commit/?id=7dc58828f494ae8fc06ef014b01b2dbea855091b
- mixer(8): Update FILES section: https://cgit.freebsd.org/src/commit/?id=26e7e9a6a2a2ee8101b0d06c83ac6d66b78a985d
- Retired https://wiki.freebsd.org/Sound for the following reasons:
	- Much of the information there is outdated, and the page is not
	  frequently maintained.
	- We have a Handbook section on sound, which will get improved.
	- There is an upcoming Journal article, which includes some the useful
	  information from the Wiki page, mostly the historical ones.

#### Ongoing Tasks

- sound: Add kqueue support: https://reviews.freebsd.org/D53029
- Working on a hot-unload test script.
- [PR 290496](https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=290496)
	- Proposed patch: https://bz-attachments.freebsd.org/attachment.cgi?id=265133
- [PR 290462](https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=290462)

#### Code Reviews

- sound examples: Extend and clean up: https://reviews.freebsd.org/D53353
