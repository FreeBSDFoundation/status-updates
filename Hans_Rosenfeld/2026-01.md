# January 2026 Status Update for Hans Rosenfeld

[//]: <Week 5>
## **Reporting Period:** [2026-01-26] - [2026-02-01]

### Project: Full CPUID Control for bhyve
#### **Overall Status:** Delayed
#### **Summary**
Finished the implementation of `bhyvectl --get-cpuid`.  By specifying the
CPUID leaf and optionally index, it can be used to dump any individual CPUID
leaf/index value emulated for the guest by bhyve, for any of its VCPUs (even
non-existing VCPUs).

In addition, without arguments it will attempt to dump the whole set of
supported CPUID leaves similar to how `bhyvectl --get-cpuid-cfg` works,
but working on values emulated for the guest by bhyve. There are also two modes
which dump the CPUID information in a format suitable for inclusion in a bhyve
configuration file, one to dump the whole set and one to create a sparse/minimal
configuration.
#### **Completed Tasks**
Implementation of `bhyvectl --get-cpuid`.

#### **Features Delivered**
Easier inspection of CPUID emulation and simplified config file generation for
CPUID control.

#### **Next Steps**
Adapt the CPUID configuration and emulation code to allow for "sparse"
configurations.  This can be handled by extending the CPUID emulation to look
up CPUID values from the configuration, and only falling back to a native CPUID
instruction if none exists.

### Miscellaneous
#### **Open Questions and Discussion**

While in no way related to the CPUID work funded by the FreeBSD Foundation,
I still have a bunch of VirtIO-SCSI related reviews out on Phabricator that
resulted from a project I recently worked on. Just in case anyone has spare
cycles or a particular interest in the subject matter, here are the reviews
on Phabricator:

- https://reviews.freebsd.org/D53465 (already accepted)
- https://reviews.freebsd.org/D53466 (already accepted)
- https://reviews.freebsd.org/D53467 (already accepted)
- https://reviews.freebsd.org/D53468
- https://reviews.freebsd.org/D53469
- https://reviews.freebsd.org/D53470
- https://reviews.freebsd.org/D53221
- https://reviews.freebsd.org/D53222
- https://reviews.freebsd.org/D53223
- https://reviews.freebsd.org/D54073

[//]: <Week 4>
## **Reporting Period:** [2026-01-19] - [2026-01-25]

### Project: Full CPUID Control for bhyve
#### **Overall Status:** Delayed
#### **Summary**
Re-tested existing CPUID changes after rebase. Began devising a rework of the
kernel bits to allow sparse configuration and automated overrides of static or
VM-state dependent information (as in illumos #16647). Began implementing
`bhyvectl --get-cpuid=<leaf>[,<index>]` to ease testing.
#### **Completed Tasks**
The bhyve header changes ( https://reviews.freebsd.org/D51550 ) have been
committed by markj. Thanks!

#### **Next Steps**
Get the bhyvectl changes working. Implement partial/sparse CPUID configuration
support in vmm.

### Miscellaneous
#### **Challenges**
For the 3rd time in 2 weeks I rebased my work onto the latest main branch and
had to deal with unrelated build failures and/or system panics. Is that
something that's generally to be expected when tracking main? Should I rebase
less often?

[//]: <Week 3>
## **Reporting Period:** [2026-01-12 - [2026-01-18]

### Project: Full CPUID Control for bhyve
#### **Overall Status:** Delayed
#### **Summary**
Ported illumos#16647 (https://illumos.org/issues/16647 ). This automatically changes CPUID bits which need to reflect on CPU configuration changes made by the guest. This required a port of a small part of illumos#14598 (https://illumos.org/issues/14598) to work.

Rebased everything on recent bhyve header refactoring.

#### **Completed Tasks**
- strtonumx() got committed (https://reviews.freebsd.org/D54270 )
- walk_config_nodes() for bhyve got committed  (https://reviews.freebsd.org/D51551 )

#### **Next Steps**
Implement support for partial/sparse CPUID configuration.

### Miscellaneous
#### **Summary**

There's another change that has been accepted in review:
- https://reviews.freebsd.org/D51550

In case anyone wants to comit this, the put the change with an updated commit message here:
- https://github.com/hrosenfeld/freebsd-src/tree/bhyve-headers

[//]: <Week 2>
## **Reporting Period:** [2026-01-05] - [2026-01-11]

### Project: Full CPUID Control for bhyve
#### **Overall Status:** Delayed
#### **Summary**
Nothing happened this week due to illness.

### Miscellaneous
#### **Summary**

The strtonumx() port was accepted in review: https://reviews.freebsd.org/D54270

In case anyone wants to help me out and commit this, the change can be found here:
- https://github.com/hrosenfeld/freebsd-src/tree/strtonumx

And there's more completed and accepted changes here:
- https://github.com/hrosenfeld/freebsd-src/tree/bhyve-headers (https://reviews.freebsd.org/D51550)
- https://github.com/hrosenfeld/freebsd-src/tree/bhyve-walk-config-nodes (https://reviews.freebsd.org/D51551)

Please let me know if there's anything else needed from me to move these forward.

[//]: <> (##########################################################)
